<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>省市县三级联动效果实现</title>
</head>
<style type="text/css">
	#container{margin:0px auto; width:500px; }
</style>
<script type="text/javascript">
	// 定义底层类
	/*var Dsy = {
		createNew: function(){
			var dsy = {};
			
			dsy.items = {};
			dsy.add= function(id, array){
				dsy.items[id] = array;
			};
			dsy.exist= function(id){
				if( typeof(dsy.items[id]) == "undefined" )
					return false;
				return true;
			};
			return dsy;
		}
		
	}; */
	var Dsy = {
		items : {},
		add : function(id, array){
				this.items[id] = array;
		},
		exist : function(id){
			if( typeof(this.items[id]) == "undefined" )
				return false;
			return true;
		}
	};
	/*function Dsy() 
	{ 
		this.items = {}; 
	} 
	Dsy.prototype.add = function(id,iArray) 
	{ 
		this.items[id] = iArray; 
	} 
	Dsy.prototype.exist = function(id) 
	{ 
		if(typeof(this.items[id]) == "undefined") 
			return false; 
		return true; 
	} */
	//var dsy = new Dsy();
	//var dsy = Dsy.createNew();
	var dsy = Object.create(Dsy);
	dsy.add("0",["北京","广东省","甘肃省","江西省","湖北省"]);
	dsy.add("0_0", ["北京"]);  // 北京就一个市，自己
	dsy.add("0_0_1", ["朝阳区", "西城区","东城区"]);  // 北京市所有县 

	dsy.add("0_1",["广州市", "珠海市", "深圳市", "佛山市", "河源市", "梅州市"]);  // 广东省所有市
	dsy.add("0_1_0", ["番禺区", "荔湾区", "白云区", "越秀区", "海珠区"]);  //广州市所有区
	dsy.add("0_1_1", ["香洲区", "金湾区", "斗门区"]);  // 珠海市所有区 

	dsy.add("0_2", ["兰州市","天水市","宝鸡市"]);  // 甘肃省所有市
	dsy.add("0_2_0", ["小兰县","大蓝县","兰兰县"]); // 兰州市所有县  
	
	// 重点来了
	function change(level){
		var str ="0";
		for( var i = 0; i < level; i++ ){
			str += ("_" + (document.getElementById(s[i]).selectedIndex - 1));
		}

		var ss = document.getElementById(s[level]);
		with(ss){	// 将{}的语句块的缺省对象设置为ss
			length = 0;  // 设置下拉列表初始长度为0,全名是ss.length
			options[0] = new Option(opt0[level], opt0[level]);  // 下拉列表第一个选项为提示,全名ss.options
			if(level && document.getElementById(s[level-1]).selectedIndex > 0 || !level ){ 
				if(	dsy.exist(str) ){
					var tmp = dsy.items[str];  
					for( var i = 0; i < tmp.length; i++ )
						options[length] = new Option(tmp[i], tmp[i]);
				}
				if(level)
					options[1].selected = true;
			}
			if( ++level < s.length )
				change(level);
		}
	}
	var s = ["province", "city", "country"]; 
	var opt0 = ["省份", "地级市","市、县级市、县"];
	function setup(){
		for( var i = 0; i < s.length - 1; i++ ){
			document.getElementById(s[i]).onchange = new Function("change(" + (i + 1) + ")");  // 用其它的代替会出问题，待解
		}
		change(0);
	}
</script>
<body>
	<div id="container">
		<select id="province"></select>
		<select id="city"></select>
		<select id="country"></select>
	</div>
	<!-- 初始化三级联动 -->
	<script type="text/javascript">
		setup();
	</script>
</body>
</html>